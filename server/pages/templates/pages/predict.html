{% extends 'base.html' %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}

<h2>–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —É—Ä–æ–≤–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø–æ —á–∞—Å–∞–º —Å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏</h2>
<canvas id="criticalityChart" width="600" height="200"></canvas>

<h3>–û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è</h3>

<ul style="text-align:left;">
    <li>‚õà - –æ—Å–∞–¥–∫–∏</li>
    <li>üéâ - —Å–æ–±—ã—Ç–∏–µ</li>
</ul>

<script>
    const ctx = document.getElementById('criticalityChart').getContext('2d');
    const hours = [...Array(24).keys()]; // –ß–∞—Å—ã —Å 0 –ø–æ 23
    const criticalityLevels = [
        2, 3, 4, 5, 6, 7, 8, 9, 4, 3, 2, 6, 5, 8, 7, 6, 4, 2, 1, 3, 4, 5, 6, 7
    ]; // –ü—Ä–∏–º–µ—Ä —É—Ä–æ–≤–Ω–µ–π –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
    const features = [
        "neutral", "neutral", "precipitation", "precipitation", "precipitation", "neutral", "neutral", "neutral",
        "neutral", "event", "neutral", "neutral", "neutral", "event", "neutral", "neutral", "neutral", 
        "neutral", "neutral", "event", "neutral", "neutral", "precipitation", "event", "neutral"
    ]; // –°—Ç–æ–ª–±–µ—Ü –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
    const getColor = (level) => {
        if (level >= 1 && level <= 3) return 'green';
        if (level >= 4 && level <= 5) return 'yellow';
        if (level >= 6 && level <= 7) return 'orange';
        return 'red'; // –î–ª—è —É—Ä–æ–≤–Ω–µ–π 8-10
    };

    // –ú–∞—Å—Å–∏–≤—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞
    const backgroundColors = criticalityLevels.map(getColor); // –¶–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤
    const borderColors = criticalityLevels.map(getColor); // –¶–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞–Ω–∏—Ü —Å—Ç–æ–ª–±—Ü–æ–≤

    // –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å–∞–¥–∫–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π
    const annotations = features.map((feature, index) => {
        if (feature === "precipitation") {
            return {
                x: hours[index],
                y: criticalityLevels[index] + 0.5, // –ü–æ–∑–∏—Ü–∏—è –æ—Å–∞–¥–∫–∏ —á—É—Ç—å –≤—ã—à–µ —É—Ä–æ–≤–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
                symbol: '‚õà' // –ó–Ω–∞—á–æ–∫ –æ—Å–∞–¥–∫–æ–≤
            };
        }
        if (feature === "event") {
            return {
                x: hours[index],
                y: criticalityLevels[index] + 0.5, // –ü–æ–∑–∏—Ü–∏—è —Å–æ–±—ã—Ç–∏—è —á—É—Ç—å –≤—ã—à–µ —É—Ä–æ–≤–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
                symbol: 'üéâ' // –ó–Ω–∞—á–æ–∫ —Å–æ–±—ã—Ç–∏—è
            };
        }
        return null; // –ï—Å–ª–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å, –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
    }).filter(annotation => annotation !== null); // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ–º –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
 // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
    const chart = new Chart(ctx, {
        type: 'bar', // –¢–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã - –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞
        data: {
            labels: hours, // –ú–µ—Ç–∫–∏ –ø–æ –æ—Å–∏ X (—á–∞—Å—ã)
            datasets: [{
                label: '–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏',
                data: criticalityLevels, // –î–∞–Ω–Ω—ã–µ –ø–æ —É—Ä–æ–≤–Ω—è–º –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
                backgroundColor: backgroundColors, // –¶–≤–µ—Ç —Å—Ç–æ–ª–±—Ü–æ–≤
                borderColor: borderColors, // –¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü —Å—Ç–æ–ª–±—Ü–æ–≤
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: '–ß–∞—Å –¥–Ω—è'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: '–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏'
                    },
                    min: 0,
                    max: 10
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return `–ß–∞—Å: ${tooltipItem.label}, –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: ${tooltipItem.raw}`;
                        }
                    }
                }
            }
        }
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (–æ—Å–∞–¥–∫–∏ –∏ —Å–æ–±—ã—Ç–∏—è) –Ω–∞ –≥—Ä–∞—Ñ–∏–∫
    annotations.forEach(annotation => {
        chart.canvas.addEventListener('mousemove', (event) => {
            const ctx = chart.ctx;
            const x = chart.scales.x.getPixelForValue(annotation.x);
            const y = chart.scales.y.getPixelForValue(annotation.y);
            ctx.font = '18px Arial';
            ctx.fillText(annotation.symbol, x - 10, y);
        });
    });

</script>

{% endblock %}
